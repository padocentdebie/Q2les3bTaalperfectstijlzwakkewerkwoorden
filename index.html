<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taalvaardigheid: De d/t Focus - Politieschool</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCJ5of6K5MRFXMOiEqEyZxZbs1xoJtXuN8",
            authDomain: "pvaangifteinleveren.firebaseapp.com",
            databaseURL: "https://pvaangifteinleveren-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "pvaangifteinleveren",
            storageBucket: "pvaangifteinleveren.firebasestorage.app",
            messagingSenderId: "989190242332",
            appId: "1:989190242332:web:867ea95845325cf9835fd9"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // 80% focus op d/t stammen (zwakke werkwoorden)
        const werkwoordenTabel = [
            ["melden", "meld", "meldt", "meldde"], ["beantwoorden", "beantwoord", "beantwoordt", "beantwoordde"],
            ["rusten", "rust", "rust", "rustte"], ["wachten", "wacht", "wacht", "wachtte"],
            ["landen", "land", "landt", "landde"], ["branden", "brand", "brandt", "brandde"],
            ["leiden", "leid", "leidt", "leidde"], ["zetten", "zet", "zet", "zette"],
            ["vermoeden", "vermoed", "vermoedt", "vermoedde"], ["pleiten", "pleit", "pleit", "pleitte"],
            ["stoten", "stoot", "stoot", "stootte"], ["schudden", "schud", "schudt", "schudde"],
            ["laden", "laad", "laadt", "laadde"], ["planten", "plant", "plant", "plantte"],
            ["bloeden", "bloed", "bloedt", "bloedde"], ["starten", "start", "start", "startte"],
            ["bereiden", "bereid", "bereidt", "bereidde"], ["begroeten", "begroet", "begroet", "begroette"],
            ["aanvaarden", "aanvaard", "aanvaardt", "aanvaardde"], ["achten", "acht", "acht", "achtte"],
            ["maken", "maak", "maakt", "maakte"], ["pakken", "pak", "pakt", "pakte"], // 20% overige zwak
            ["bellen", "bel", "belt", "belde"], ["stoppen", "stop", "stopt", "stopte"],
            ["horen", "hoor", "hoort", "hoorde"]
        ];

        const contextZinnen = [
            { q: "De agent (melden) _____ het incident via de porto.", a: "meldt" },
            { q: "Gisteren (beantwoorden) _____ de verdachte geen enkele vraag.", a: "beantwoordde" },
            { q: "Waarom (melden) _____ jij die diefstal niet meteen?", a: "meld" },
            { q: "De officier (leiden) _____ gisteren de zoeking.", a: "leidde" },
            { q: "De verdachte (zetten) _____ gisteren een stap achteruit.", a: "zette" },
            { q: "De rechercheur (vermoeden) _____ gisteren al dat er opzet was.", a: "vermoedde" },
            { q: "Jij (beantwoorden) _____ de vragen van de burger heel netjes.", a: "beantwoordt" },
            { q: "(Wachten) _____ jij al lang op de back-up?", a: "wacht" },
            { q: "De getuige (schudden) _____ gisteren alleen haar hoofd.", a: "schudde" },
            { q: "Vannacht (branden) _____ er een licht in het pand.", a: "brandde" },
            { q: "Het slachtoffer (bloeden) _____ gisteren uit een hoofdwond.", a: "bloedde" },
            { q: "Wanneer (starten) _____ jij morgen met je surveillance?", a: "start" },
            { q: "De agent (beantwoorden) _____ de oproep direct.", a: "beantwoordt" },
            { q: "Gisteren (landen) _____ de traumahelikopter op de snelweg.", a: "landde" },
            { q: "De verdachte (pleiten) _____ gisteren onschuldig.", a: "pleitte" },
            { q: "Jij (leiden) _____ de stagiair vandaag rond.", a: "leidt" },
            { q: "(Zetten) _____ jij de handboeien even om?", a: "zet" },
            { q: "De advocaat (aanvaarden) _____ het schikkingsvoorstel.", a: "aanvaardt" },
            { q: "Wij (wachten) _____ gisteren op de komst van de officier.", a: "wachtten" },
            { q: "De auto (stoten) _____ gisteren tegen het paaltje.", a: "stootte" },
            { q: "De centralist (melden) _____ de locatie van de verdachte.", a: "meldt" },
            { q: "Gisteren (laden) _____ wij de inbeslagnomen goederen in.", a: "laadden" },
            { q: "Het vuur (branden) _____ gisteren urenlang door.", a: "brandde" },
            { q: "De hond (beantwoorden) _____ het commando direct.", a: "beantwoordt" },
            { q: "Jij (starten) _____ gisteren de motor te laat.", a: "startte" }
        ];

        window.onload = () => {
            const tbody = document.getElementById('verb-body');
            werkwoordenTabel.forEach((rij, i) => {
                const tr = document.createElement('tr');
                const showIndex = Math.floor(Math.random() * 4);
                rij.forEach((woord, j) => {
                    const td = document.createElement('td');
                    if (j === showIndex) { td.innerText = woord; td.className = "fixed-word"; }
                    else {
                        const input = document.createElement('input');
                        input.type = "text"; input.id = `v-${i}-${j}`; input.dataset.correct = woord;
                        td.appendChild(input);
                    }
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });

            const zinContainer = document.getElementById('context-zinnen');
            contextZinnen.forEach((item, i) => {
                const div = document.createElement('div');
                div.className = "sentence-row";
                div.innerHTML = `${i+1}. ${item.q} <input type="text" id="c-${i}" data-correct="${item.a}" class="context-input">`;
                zinContainer.appendChild(div);
            });
        };

        window.checkAndSave = function() {
            const className = document.getElementById('selectedClass').value;
            const firstName = document.getElementById('firstName').value;
            if(!className || !firstName) { alert("Voornaam en klas zijn verplicht."); return; }

            let correct = 0; let total = 0;
            document.querySelectorAll('input[data-correct]').forEach(input => {
                total++;
                if (input.value.trim().toLowerCase() === input.dataset.correct) {
                    input.className = "correct"; correct++;
                } else { input.className = "incorrect"; }
            });

            const eigenZinnen = [];
            for(let i=1; i<=10; i++) { eigenZinnen.push(document.getElementById(`z${i}`).value); }

            push(ref(db, 'werkwoorden/' + className), {
                student: firstName,
                score: `${correct}/${total}`,
                zinnen: eigenZinnen,
                feedback: null,
                timestamp: Date.now()
            }).then(() => alert(`Opgeslagen! Deel dit nu met je klasgenoten voor feedback.`));
        };

        window.loadResults = (c) => {
            document.getElementById('viewing').innerText = c;
            onValue(ref(db, 'werkwoorden/' + c), (s) => {
                const d = s.val();
                const resDiv = document.getElementById('results');
                resDiv.innerHTML = d ? "" : "Nog geen resultaten.";
                for(let k in d) {
                    let fbHtml = d[k].feedback ? `<div class="feedback-box"><strong>Feedback:</strong> ${d[k].feedback}</div>` : 
                        `<button onclick="openFeedback('${c}', '${k}')">Geef Feedback aan ${d[k].student}</button>`;
                    
                    resDiv.innerHTML += `<div class="res-card">
                        <div class="card-header">Student: <strong>${d[k].student}</strong> (Score: ${d[k].score})</div>
                        <div class="student-sentences">
                            <strong>Eigen PV-Zinnen:</strong><br>
                            ${d[k].zinnen.map((z, i) => `<em>${i+1}:</em> ${z}`).join('<br>')}
                        </div>
                        ${fbHtml}
                    </div>`;
                }
            });
        };

        window.openFeedback = (klas, id) => {
            const fb = prompt("Controleer op d/t:\n1. Ik-vorm = stam (eindigt op d of t)?\n2. TT (hij) = stam + t (dt of tt)?\n3. VT = stam + de of te (dubbel d of t)?\n\nTyp feedback:");
            if(fb) { update(ref(db, `werkwoorden/${klas}/${id}`), { feedback: fb }); }
        };

        window.hardReset = () => {
            const c = document.getElementById('viewing').innerText;
            if(c !== "..." && confirm(`Data van klas ${c} wissen?`)) { remove(ref(db, 'werkwoorden/' + c)); }
        };
    </script>
    <style>
        body { font-family: 'Arial', sans-serif; background: #f4f4f4; padding: 20px; }
        .container { max-width: 1000px; margin: auto; background: #fff; padding: 25px; border: 2px solid #003366; }
        h1, h2 { background: #003366; color: white; padding: 10px; font-size: 1.1rem; }
        .uitleg { background: #eef; border-left: 5px solid #003366; padding: 15px; margin-bottom: 20px; font-size: 0.9rem; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; font-size: 0.85rem; }
        .correct { background: #dff0d8 !important; }
        .incorrect { background: #f2dede !important; }
        .res-card { border: 1px solid #003366; margin: 10px 0; background: #fafafa; }
        .student-sentences { padding: 10px; font-size: 0.85rem; }
        .feedback-box { background: #d9edf7; padding: 10px; margin: 10px; border: 1px solid #bce8f1; font-style: italic; }
        button { background: #003366; color: white; border: none; padding: 10px; cursor: pointer; }
        .full-input { width: 100%; margin-bottom: 5px; padding: 8px; border: 1px solid #999; }
    </style>
</head>
<body>
<div class="container">
    <h1>Focus: Werkwoordstammen op d en t</h1>
    
    <div class="uitleg">
        <strong>De d/t focus:</strong><br>
        - <strong>TT:</strong> Ik mel<strong>d</strong> -> Hij mel<strong>dt</strong> (stam+t). | Ik wach<strong>t</strong> -> Hij wach<strong>t</strong> (stam+t = tt, maar we schrijven er één).<br>
        - <strong>VT:</strong> Stam + <strong>de</strong> (mel<strong>dde</strong>) of Stam + <strong>te</strong> (wach<strong>tte</strong>). Let op de dubbele letters!
    </div>

    <div style="margin-bottom:20px;">
        Voornaam: <input type="text" id="firstName">
        Klas: <select id="selectedClass">
            <option value="Delta">Delta</option><option value="Echo">Echo</option>
            <option value="Foxtrot">Foxtrot</option><option value="Lima">Lima</option>
            <option value="Mike">Mike</option>
        </select>
    </div>

    <h2>Deel 1: Tabel (Focus op d/t stammen)</h2>
    <table><thead><tr><th>Hele werkwoord</th><th>Ik (stam)</th><th>Hij (TT)</th><th>Verleden Tijd</th></tr></thead><tbody id="verb-body"></tbody></table>

    <h2>Deel 2: Contextuele oefening (25 zinnen)</h2>
    <div id="context-zinnen"></div>

    <h2>Deel 3: 10 Eigen PV-zinnen</h2>
    <p>Maak zinnen met: 2x Ik-vorm | 2x Hij/Zij (TT) | 3x VT (+te) | 3x VT (+de)</p>
    <div id="eigen-zinnen">
        <input type="text" id="z1" class="full-input" placeholder="1. Ik-vorm">
        <input type="text" id="z2" class="full-input" placeholder="2. Ik-vorm">
        <input type="text" id="z3" class="full-input" placeholder="3. Hij/Zij (Tegenwoordig)">
        <input type="text" id="z4" class="full-input" placeholder="4. Hij/Zij (Tegenwoordig)">
        <input type="text" id="z5" class="full-input" placeholder="5. Verleden tijd (+te)">
        <input type="text" id="z6" class="full-input" placeholder="6. Verleden tijd (+te)">
        <input type="text" id="z7" class="full-input" placeholder="7. Verleden tijd (+te)">
        <input type="text" id="z8" class="full-input" placeholder="8. Verleden tijd (+de)">
        <input type="text" id="z9" class="full-input" placeholder="9. Verleden tijd (+de)">
        <input type="text" id="z10" class="full-input" placeholder="10. Verleden tijd (+de)">
    </div>

    <button onclick="checkAndSave()" style="width:100%; height:50px; font-weight:bold;">OPSLAAN & CONTROLEREN</button>

    <hr>
    <h2>Klasoverzicht & Feedback</h2>
    <div style="margin-bottom: 10px;">
        <button onclick="loadResults('Delta')">Delta</button>
        <button onclick="loadResults('Echo')">Echo</button>
        <button onclick="loadResults('Foxtrot')">Foxtrot</button>
        <button onclick="loadResults('Lima')">Lima</button>
        <button onclick="loadResults('Mike')">Mike</button>
    </div>
    <div id="results"></div>
    <span id="viewing" style="display:none;">...</span>
    <button onclick="hardReset()" style="background:#900; margin-top:20px;">Wis klasdata</button>
</div>
</body>
</html>
