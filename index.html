<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taalvaardigheid: De d/t Focus - Politieschool</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCJ5of6K5MRFXMOiEqEyZxZbs1xoJtXuN8",
            authDomain: "pvaangifteinleveren.firebaseapp.com",
            databaseURL: "https://pvaangifteinleveren-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "pvaangifteinleveren",
            storageBucket: "pvaangifteinleveren.firebasestorage.app",
            messagingSenderId: "989190242332",
            appId: "1:989190242332:web:867ea95845325cf9835fd9"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const werkwoordenTabel = [
            ["melden", "meld", "meldt", "meldde"], 
            ["beantwoorden", "beantwoord", "beantwoordt", "beantwoordde"],
            ["misten", "mist", "mist", "mistte"],
            ["rusten", "rust", "rust", "rustte"], 
            ["wachten", "wacht", "wacht", "wachtte"],
            ["landen", "land", "landt", "landde"], 
            ["branden", "brand", "brandt", "brandde"],
            ["leiden", "leid", "leidt", "leidde"], 
            ["zetten", "zet", "zet", "zette"],
            ["vermoeden", "vermoed", "vermoedt", "vermoedde"], 
            ["pleiten", "pleit", "pleit", "pleitte"]
        ];

        const contextZinnen = [
            { q: "De agent (melden, TT, hij-vorm) _____ het incident nu via de porto.", a: "meldt" },
            { q: "Gisteren (beantwoorden, VT, hij-vorm) _____ de verdachte de vraag niet.", a: "beantwoordde" },
            { q: "Toen we de snelweg opreden (misten, VT, het-vorm) _____ het heel erg.", a: "mistte" },
            { q: "De officier (leiden, VT, hij-vorm) _____ vorig jaar het onderzoek.", a: "leidde" },
            { q: "Ik (wachten, TT, ik-vorm) _____ al een uur op de back-up.", a: "wacht" },
            { q: "Jij (wachten, VT, jij-vorm) _____ gisteren te lang op assistentie.", a: "wachtte" },
            { q: "De verdachte (vermoeden, VT, hij-vorm) _____ destijds al een valstrik.", a: "vermoedde" },
            { q: "De rechercheur (beantwoorden, TT, hij-vorm) _____ op dit moment de mail.", a: "beantwoordt" },
            { q: "Vorig jaar (landen, VT, hij-vorm) _____ de helikopter in het park.", a: "landde" },
            { q: "De agent (zetten, VT, hij-vorm) _____ de handboeien gisteren strak aan.", a: "zette" },
            { q: "De verdachte (pleiten, TT, hij-vorm) _____ zojuist onschuldig.", a: "pleit" },
            { q: "Gisteren (branden, VT, het-vorm) _____ er nog licht in de verhoorkamer.", a: "brandde" },
            { q: "Ik (melden, TT, ik-vorm) _____ mij morgen bij de hoofdinspecteur.", a: "meld" }
        ];

        window.onload = () => {
            const tbody = document.getElementById('verb-body');
            werkwoordenTabel.forEach((rij, i) => {
                const tr = document.createElement('tr');
                const showIndex = Math.floor(Math.random() * 4);
                rij.forEach((woord, j) => {
                    const td = document.createElement('td');
                    if (j === showIndex) { td.innerText = woord; td.className = "fixed-word"; }
                    else {
                        const input = document.createElement('input');
                        input.type = "text"; input.id = `v-${i}-${j}`; input.dataset.correct = woord;
                        td.appendChild(input);
                    }
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });

            const zinContainer = document.getElementById('context-zinnen');
            contextZinnen.forEach((item, i) => {
                const div = document.createElement('div');
                div.className = "sentence-row";
                div.innerHTML = `${i+1}. ${item.q} <input type="text" id="c-${i}" data-correct="${item.a}" class="context-input">`;
                zinContainer.appendChild(div);
            });
        };

        window.checkAndSave = function() {
            const className = document.getElementById('selectedClass').value;
            const firstName = document.getElementById('firstName').value;
            if(!firstName) { alert("Vul eerst je voornaam in!"); return; }

            let correct = 0; let total = 0;
            document.querySelectorAll('input[data-correct]').forEach(input => {
                total++;
                if (input.value.trim().toLowerCase() === input.dataset.correct) {
                    input.className = "correct"; correct++;
                } else { input.className = "incorrect"; }
            });

            const eigenZinnen = [];
            for(let i=1; i<=10; i++) { eigenZinnen.push(document.getElementById(`z${i}`).value); }

            push(ref(db, 'werkwoorden/' + className), {
                student: firstName,
                score: `${correct}/${total}`,
                zinnen: eigenZinnen,
                feedback: null,
                timestamp: Date.now()
            }).then(() => alert(`Opgeslagen! Bedankt ${firstName}. Je klasgenoten kunnen nu feedback geven.`));
        };

        window.loadResults = (c) => {
            document.getElementById('viewing').innerText = c;
            onValue(ref(db, 'werkwoorden/' + c), (s) => {
                const d = s.val();
                const resDiv = document.getElementById('results');
                resDiv.innerHTML = d ? "" : "Nog geen resultaten gevonden voor deze klas.";
                for(let k in d) {
                    let fbHtml = d[k].feedback ? `<div class="feedback-box"><strong>Feedback:</strong><br>${d[k].feedback.replace(/\n/g, '<br>')}</div>` : 
                        `<button onclick="openFeedback('${c}', '${k}')">Geef Feedback aan ${d[k].student}</button>`;
                    
                    resDiv.innerHTML += `<div class="res-card">
                        <div class="card-header">Student: <strong>${d[k].student}</strong> (Score: ${d[k].score})</div>
                        <div class="student-sentences">
                            <strong>Eigen Zinnen:</strong><br>
                            ${d[k].zinnen.map((z, i) => `<em>${i+1}:</em> ${z}`).join('<br>')}
                        </div>
                        ${fbHtml}
                    </div>`;
                }
            });
        };

        window.openFeedback = (klas, id) => {
            const checklistTemplate = "CHECKLIST:\n[ ] Stam+t bij TT gebruikt?\n[ ] Stam+de/te bij VT gebruikt?\n[ ] Dubbel d/t gecheckt?\n\nTip: ";
            const fb = prompt("Beoordeel het werk van je klasgenoot:\n(Zet een X in de hokjes)", checklistTemplate);
            if(fb && fb !== checklistTemplate) { 
                update(ref(db, `werkwoorden/${klas}/${id}`), { feedback: fb }); 
            }
        };

        window.hardReset = () => {
            const c = document.getElementById('viewing').innerText;
            if(c === "...") { alert("Selecteer eerst een klas die je wilt legen."); return; }
            if(confirm(`LET OP: Alle namen, scores en feedback van klas ${c} worden definitief verwijderd. Doorgaan?`)) { 
                remove(ref(db, 'werkwoorden/' + c)).then(() => alert("De database voor deze klas is nu leeg."));
            }
        };
    </script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; padding: 20px; color: #333; }
        .container { max-width: 1000px; margin: auto; background: #fff; padding: 30px; border: 2px solid #003366; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h1, h2 { background: #003366; color: white; padding: 15px; font-size: 1.25rem; border-radius: 6px; margin-top: 35px; }
        h1 { margin-top: 0; text-align: center; }
        .header-section { display: flex; gap: 20px; align-items: center; margin-bottom: 25px; background: #f9fbff; padding: 15px; border-radius: 10px; border: 1px solid #d0d7de; }
        .uitleg { flex: 1; font-size: 1rem; line-height: 1.6; }
        .header-gif { width: 150px; height: auto; border-radius: 8px; border: 2px solid #003366; }
        .login-box { background: #e7efff; padding: 20px; border-radius: 8px; margin-bottom: 25px; border: 1px solid #00336620; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; background: #fff; }
        th, td { border: 1px solid #cbd5e0; padding: 12px; text-align: left; }
        th { background: #edf2f7; font-weight: bold; }
        .correct { background: #c6f6d5 !important; border-color: #38a169; }
        .incorrect { background: #fed7d7 !important; border-color: #e53e3e; }
        .res-card { border: 1px solid #003366; margin: 20px 0; background: #fff; border-radius: 8px; overflow: hidden; }
        .card-header { background: #00336608; padding: 12px; border-bottom: 1px solid #00336615; font-weight: bold; }
        .student-sentences { padding: 15px; font-size: 0.9rem; line-height: 1.7; color: #4a5568; }
        .feedback-box { background: #ebf8ff; padding: 15px; margin: 15px; border: 1px solid #bee3f8; font-style: italic; border-radius: 6px; color: #2b6cb0; }
        button { background: #003366; color: white; border: none; padding: 12px 24px; cursor: pointer; border-radius: 6px; font-weight: bold; transition: 0.2s; }
        button:hover { background: #0055aa; transform: translateY(-1px); }
        .btn-danger { background: #e53e3e; margin-top: 50px; font-size: 0.85rem; opacity: 0.8; }
        .btn-danger:hover { background: #c53030; opacity: 1; }
        .full-input { width: 100%; margin-bottom: 12px; padding: 12px; border: 1px solid #a0aec0; border-radius: 6px; box-sizing: border-box; font-size: 1rem; }
        .context-input { width: 140px; padding: 6px; border-radius: 4px; border: 1px solid #a0aec0; margin-left: 10px; }
        .sentence-row { margin-bottom: 15px; padding: 10px; border-bottom: 1px solid #edf2f7; display: flex; align-items: center; justify-content: space-between; }
    </style>
</head>
<body>
<div class="container">
    <h1>Politieschool: Taalvaardigheid d/t</h1>
    
    <div class="header-section">
        <div class="uitleg">
            <strong>Focus op werkwoordstammen op d en t:</strong><br>
            • <strong>Tegenwoordige Tijd (TT):</strong> Stam + t. (Ik mel<strong>d</strong>, hij mel<strong>dt</strong>).<br>
            • <strong>Verleden Tijd (VT):</strong> Stam + de/te. (Mel<strong>dde</strong>, wach<strong>tte</strong>, mis<strong>tte</strong>).<br>
            <em>Let goed op de dubbele medeklinkers in de verleden tijd!</em>
        </div>
        <img src="1740073406664.gif" alt="Instructie" class="header-gif">
    </div>

    <div class="login-box">
        <strong>Identificatie:</strong><br><br>
        Voornaam: <input type="text" id="firstName" placeholder="Typ je naam..." style="width: 200px; padding: 10px;">
        Klas: <select id="selectedClass" style="padding: 10px;">
            <option value="Delta">Delta</option><option value="Echo">Echo</option>
            <option value="Foxtrot">Foxtrot</option><option value="Lima">Lima</option>
            <option value="Mike">Mike</option>
        </select>
    </div>

    <h2>Deel 1: De Stam-tabel invullen</h2>
    <table><thead><tr><th>Hele werkwoord</th><th>Ik (stam)</th><th>Hij (TT)</th><th>Verleden Tijd (enkelvoud)</th></tr></thead><tbody id="verb-body"></tbody></table>

    <h2>Deel 2: Context Zinnen (Let op de instructie tussen haakjes)</h2>
    <div id="context-zinnen"></div>

    <h2>Deel 3: Eigen PV-zinnen (Wissel af tussen VT en TT)</h2>
    <p><small>Schrijf 10 volledige zinnen met de werkwoorden uit de tabel.</small></p>
    <div id="eigen-zinnen">
        <input type="text" id="z1" class="full-input" placeholder="Zin 1">
        <input type="text" id="z2" class="full-input" placeholder="Zin 2">
        <input type="text" id="z3" class="full-input" placeholder="Zin 3">
        <input type="text" id="z4" class="full-input" placeholder="Zin 4">
        <input type="text" id="z5" class="full-input" placeholder="Zin 5">
        <input type="text" id="z6" class="full-input" placeholder="Zin 6">
        <input type="text" id="z7" class="full-input" placeholder="Zin 7">
        <input type="text" id="z8" class="full-input" placeholder="Zin 8">
        <input type="text" id="z9" class="full-input" placeholder="Zin 9">
        <input type="text" id="z10" class="full-input" placeholder="Zin 10">
    </div>

    <button onclick="checkAndSave()" style="width: 100%; font-size: 1.2rem; margin-top: 10px;">OPSLAAN EN CONTROLEREN</button>

    <hr style="margin: 60px 0; border: 0; border-top: 2px dashed #cbd5e0;">
    
    <h2>Feedback Portaal</h2>
    <p>Selecteer een klas om de resultaten te bekijken en feedback te geven aan je collega's:</p>
    <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
        <button onclick="loadResults('Delta')">Delta</button>
        <button onclick="loadResults('Echo')">Echo</button>
        <button onclick="loadResults('Foxtrot')">Foxtrot</button>
        <button onclick="loadResults('Lima')">Lima</button>
        <button onclick="loadResults('Mike')">Mike</button>
    </div>
    <h3>Resultaten voor klas: <span id="viewing" style="color: #003366;">...</span></h3>
    <div id="results">Kies een klas om de lijst te laden.</div>

    <button onclick="hardReset()" class="btn-danger">WIS ALLE GEGEVENS VAN DEZE KLAS</button>
</div>
</body>
</html>
